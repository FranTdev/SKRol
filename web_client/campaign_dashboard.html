<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Campaña | Stephen King RPG</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@400;700&family=Metamorphous&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --primary-glow: rgba(183, 28, 28, 0.6);
            --bg-dark: #0a0a0a;
            --card-bg: #1a1a1a;
            --accent: #d32f2f;
            --tabs-bg: #121212;
        }

        body {
            background-color: var(--bg-dark);
            color: #e0e0e0;
            font-family: 'Crimson Pro', serif;
            margin: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        header {
            padding: 1.5rem;
            text-align: center;
            background: linear-gradient(180deg, #1a1515 0%, transparent 100%);
            border-bottom: 1px solid rgba(211, 47, 47, 0.2);
            position: relative;
        }

        .back-btn {
            position: absolute;
            left: 1.5rem;
            top: 50%;
            transform: translateY(-50%);
            text-decoration: none;
            color: var(--accent);
            font-family: 'Metamorphous', cursive;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        h1 {
            font-family: 'Metamorphous', cursive;
            color: var(--accent);
            text-shadow: 0 0 10px var(--primary-glow);
            margin: 0;
        }

        /* Tabs */
        .tabs {
            display: flex;
            justify-content: center;
            background: var(--tabs-bg);
            border-bottom: 1px solid #333;
        }

        .tab-btn {
            padding: 1rem 2rem;
            background: none;
            border: none;
            color: #888;
            font-family: 'Metamorphous', cursive;
            cursor: pointer;
            transition: all 0.3s;
            border-bottom: 2px solid transparent;
        }

        .tab-btn:hover {
            color: #fff;
        }

        .tab-btn.active {
            color: var(--accent);
            border-bottom-color: var(--accent);
            background: rgba(211, 47, 47, 0.05);
        }

        .container {
            max-width: 1000px;
            margin: 2rem auto;
            padding: 0 1rem;
            flex-grow: 1;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Common Elements */
        .card {
            background: var(--card-bg);
            border: 1px solid rgba(255, 255, 255, 0.05);
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
        }

        .btn {
            background: rgba(211, 47, 47, 0.1);
            border: 1px solid var(--accent);
            color: var(--accent);
            padding: 0.6rem 1.2rem;
            font-family: 'Metamorphous', cursive;
            cursor: pointer;
            border-radius: 4px;
            transition: 0.3s;
        }

        .btn:hover {
            background: var(--accent);
            color: white;
        }

        /* Participantes Styles */
        .search-box {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .search-box input {
            flex-grow: 1;
            background: #2a2a2a;
            border: 1px solid #444;
            padding: 0.8rem;
            color: white;
            border-radius: 4px;
        }

        .search-results {
            margin-bottom: 2rem;
            border: 1px solid #333;
            border-radius: 4px;
            display: none;
        }

        .result-item {
            padding: 0.8rem;
            border-bottom: 1px solid #222;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .participant-list {
            display: grid;
            gap: 1rem;
        }

        .participant-item {
            background: #111;
            padding: 1rem;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* Personajes Styles */
        .char-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
        }

        .char-card {
            background: #1a1a1a;
            border-left: 4px solid var(--accent);
            padding: 1rem;
            border-radius: 4px;
        }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: var(--card-bg);
            padding: 2rem;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            border: 1px solid var(--accent);
        }

        .form-row {
            margin-bottom: 1rem;
        }

        .form-row label {
            display: block;
            margin-bottom: 0.3rem;
            color: #888;
        }

        .form-row input,
        .form-row select,
        .form-row textarea {
            width: 100%;
            padding: 0.6rem;
            background: #222;
            border: 1px solid #444;
            color: white;
            border-radius: 4px;
        }

        /* Detailed sheet */
        .detailed-sheet {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-dark);
            z-index: 1500;
            overflow-y: auto;
            padding: 2rem;
            animation: slideUp 0.4s ease-out;
        }

        @keyframes slideUp {
            from {
                transform: translateY(100%);
            }

            to {
                transform: translateY(0);
            }
        }

        .sheet-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid var(--accent);
            padding-bottom: 1rem;
            margin-bottom: 2rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-box {
            background: #111;
            padding: 1rem;
            border: 1px solid #333;
            text-align: center;
            border-radius: 4px;
        }

        .stat-box label {
            font-size: 0.8rem;
            color: #888;
            text-transform: uppercase;
        }

        .stat-box div {
            font-size: 1.5rem;
            font-family: 'Metamorphous', cursive;
            color: var(--accent);
        }

        .shining-machine-panel {
            background: linear-gradient(45deg, #1a0505, #05051a);
            border: 1px solid #d32f2f;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            text-align: center;
        }

        .inventory-section {
            margin-top: 2rem;
            border-top: 1px solid #333;
            padding-top: 1rem;
        }

        .item-list {
            display: grid;
            gap: 0.5rem;
        }

        .item-row {
            display: flex;
            justify-content: space-between;
            background: #1a1a1a;
            padding: 0.5rem 1rem;
            border-radius: 4px;
        }
    </style>
</head>

<body>
    <header>
        <a href="campaigns.html" class="back-btn">← Mundos</a>
        <h1 id="campaign-title">Cargando...</h1>
        <div id="campaign-admin" style="font-size: 0.8rem; color: #888; margin-top: 0.5rem;">Cargando admin...</div>
    </header>

    <nav class="tabs">
        <button class="tab-btn active" onclick="showTab('resumen')">Resumen</button>
        <button id="participantes-tab-btn" class="tab-btn" onclick="showTab('participantes')">Participantes</button>
        <button class="tab-btn" onclick="showTab('personajes')">Personajes</button>
        <button class="tab-btn" onclick="showTab('manual')">Manual</button>
    </nav>

    <div class="container">
        <!-- Tab: Resumen -->
        <div id="resumen" class="tab-content active">
            <div class="card">
                <h2>Estado del Mundo</h2>
                <p id="campaign-desc">Esta es tu campaña en el nivel actual del Haz.</p>
                <div id="campaign-date"></div>
            </div>
        </div>

        <!-- Tab: Participantes -->
        <div id="participantes" class="tab-content">
            <div class="card">
                <h2>Invocar Compañeros</h2>
                <div id="search-panel">
                    <div class="search-box">
                        <input type="text" id="user-search-input" placeholder="Buscar por nombre de usuario...">
                        <button id="search-btn" class="btn">Buscar</button>
                    </div>
                </div>
                <div id="search-results" class="search-results"></div>

                <h3>Círculo Actual</h3>
                <div id="participant-list" class="participant-list">
                    <!-- Participantes dinámicos -->
                </div>
            </div>
        </div>

        <!-- Tab: Personajes -->
        <div id="personajes" class="tab-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h2>Hojas de Personaje</h2>
                <button id="create-char-btn" class="btn">Nuevo Personaje</button>
            </div>
            <div id="char-list" class="char-grid">
                <!-- Personajes dinámicos -->
            </div>
        </div>

        <!-- Tab: Manual -->
        <div id="manual" class="tab-content">
            <div class="card" style="text-align: center; padding: 3rem;">
                <h2 style="font-family: 'Metamorphous', cursive; font-size: 2rem;">EL MANUAL DEL HAZ</h2>
                <p>Todo lo que un pistolero o un maestro necesita saber para sobrevivir.</p>
                <a href="#" class="btn" style="display: inline-block; margin-top: 2rem; padding: 1rem 2rem;">Abrir
                    Manual Completo (PDF)</a>
            </div>
        </div>
    </div>

    <!-- Modal Personaje (Creación/Edición Básica) -->
    <div id="char-modal" class="modal">
        <div class="modal-content">
            <h2 id="char-modal-title">NUEVO PERSONAJE</h2>
            <form id="char-form">
                <input type="hidden" id="char-id">
                <div class="form-row">
                    <label>Nombre</label>
                    <input type="text" id="char-name" required>
                </div>
                <div class="form-row">
                    <label>Asignar a Usuario</label>
                    <select id="char-user-select">
                        <!-- Cargado dinámicamente con participantes -->
                    </select>
                </div>
                <div class="form-row">
                    <label>Descripción</label>
                    <textarea id="char-description" rows="3"></textarea>
                </div>
                <div style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 1rem;">
                    <button type="button" onclick="closeModal('char-modal')" class="btn"
                        style="border-color: #555; color: #888;">Cerrar</button>
                    <button type="submit" class="btn">Guardar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Detailed Character Sheet -->
    <div id="detailed-sheet" class="detailed-sheet">
        <div class="sheet-header">
            <h2 id="sheet-char-name" style="font-family: 'Metamorphous', cursive; color: var(--accent); margin: 0;">
            </h2>
            <button onclick="closeDetailedSheet()" class="btn" style="border-color: #555; color: #888;">Cerrar</button>
        </div>

        <div class="stats-grid" id="sheet-stats">
            <!-- Stats will be loaded here -->
        </div>

        <div style="display: flex; gap: 1rem; margin-bottom: 2rem;">
            <button onclick="rollRandomStats()" class="btn" style="flex: 1;">Stats Aleatorios</button>
            <button onclick="openShiningMachine()" class="btn"
                style="flex: 1; border-color: #4a148c; color: #9c27b0;">Máquina del Resplandor</button>
        </div>

        <div class="card">
            <h3>Descripción</h3>
            <textarea id="sheet-desc"
                style="width: 100%; background: transparent; border: none; color: #ccc; font-family: inherit; resize: vertical;"
                rows="5" onchange="saveSheetData()"></textarea>
        </div>

        <div class="inventory-section">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <h3>Inventario</h3>
                <button onclick="addItem()" class="btn btn-small">Añadir Ítem</button>
            </div>
            <div id="item-list" class="item-list">
                <!-- Items here -->
            </div>
        </div>

        <div style="margin-top: 3rem; text-align: right;">
            <button onclick="saveSheetData()" class="btn" id="save-all-btn">Guardar Cambios</button>
        </div>
    </div>

    <!-- Modals for Shining Machine (Simulated) -->
    <div id="shining-machine-modal" class="modal">
        <div class="modal-content" style="max-width: 600px; max-height: 80vh; overflow-y: auto;">
            <h2 style="color: #9c27b0;">EL RESPLANDOR</h2>
            <div id="shining-results" style="margin-top: 1rem;">
                <!-- Results from index.js logic -->
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr>
                            <th style="padding: 0.5rem; text-align: left; border-bottom: 1px solid #333;">Rango</th>
                            <th style="padding: 0.5rem; text-align: left; border-bottom: 1px solid #333;">Habilidad</th>
                            <th style="padding: 0.5rem; text-align: left; border-bottom: 1px solid #333;">Efecto</th>
                        </tr>
                    </thead>
                    <tbody id="shining-list"></tbody>
                </table>
            </div>
            <div style="margin-top: 2rem; text-align: right;">
                <button onclick="closeModal('shining-machine-modal')" class="btn">Aceptar</button>
            </div>
        </div>
    </div>

    <script src="campaign_dashboard.js"></script>
</body>

</html>